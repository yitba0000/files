"use strict";(self.webpackChunkcollection_runner=self.webpackChunkcollection_runner||[]).push([[8183],{40721:(e,t,n)=>{n.r(t),n.d(t,{AnalyticsService:()=>r,BulkAnalytics:()=>a,initializeAnalytics:()=>c});var i=n(7560);const o=new Set(["category","action","label","value","meta","workspaceId","workspaceType","entityId","entityType","traceId","variantId","experimentId","utm_source","utm_medium","utm_campaign","utm_content","utm_term","userId","teamId"]),a=new class{constructor(){this.configuration={batchTimeout:3e4},this.timer=void 0,this.payloads=[],this.clickEventPayloads=[],this.logger=void 0,this.payloads=[]}configure(e){this.configuration=Object.entries(e).reduce(((t,[n,o])=>"logger"===n?(this.logger=e.logger,t):(0,i.Z)({},t,{[n]:o})),this.configuration),void 0===this.timer&&(this.timer=setInterval((()=>{this.sendPayloads(),this.sendClickEventPayloads()}),this.configuration.batchTimeout))}onDeactivate(){try{this.sendPayloads({isFlushBeforePageClose:!0})}catch(t){var e;null==this||null==(e=this.logger)||e.error("Flushing analytics event before page unload failed",t)}}getEnv(){var e;const t=null==(e=this.configuration)?void 0:e.environment;var n;if(!t)return null==(n=this.logger)||n.warn("The environment for analytic service was not set"),"beta";switch(t){case"prod":return"production";case"stage":return"staging";case"staging":case"production":case"beta":return t;case"dev":case"develop":case"preview":case"development":return"beta";default:throw new Error("The provided env for the analytic service is incorrect")}}getBaseObject(e){var t,n,o,a,r,s;if(null==(t=this.configuration)||null==(t=t.appDetails)||!t.property)throw new Error("the analytic service was not configured: property in missing");const l=null==(n=this.configuration)?void 0:n.userInfo,c=null==(o=this.configuration)?void 0:o.workspaceInfo,u=Array.isArray(null==l?void 0:l.organizations)&&null!=l&&l.organizations[0]?null==l?void 0:l.organizations[0].id:(null==l?void 0:l.teamId)||"0";return(0,i.Z)({type:"events-general",indexType:"client-events",env:this.getEnv(),propertyId:null==(a=this.configuration)||null==(a=a.appDetails)?void 0:a.id,propertyVersion:null==(r=this.configuration)||null==(r=r.appDetails)?void 0:r.propertyVersion,property:null==(s=this.configuration)||null==(s=s.appDetails)?void 0:s.property,userId:(null==l?void 0:l.id)||"0",teamId:u},null!=e&&e.noActiveWorkspace?{}:{workspaceId:null==c?void 0:c.id,workspaceType:null==c?void 0:c.type})}extendEventWithBaseObject(e,t){const n=(new Date).toISOString();return(0,i.Z)({},this.getBaseObject(t),{timestamp:n},Object.entries(e).reduce(((e,[t,n])=>o.has(t)&&null!=n?(0,i.Z)({},e,{[t]:n}):e),{}))}addCurrentEvent(e,t){try{const n=this.extendEventWithBaseObject(e,t);this.queuePayload(n)}catch(e){var n;null==(n=this.logger)||n.error(null==e?void 0:e.message,e)}}addCurrentClickEvent(e,t){try{const n=this.extendEventWithBaseObject(e,t);this.queueClickEventPayload(n)}catch(e){var n;null==(n=this.logger)||n.error(null==e?void 0:e.message,e)}}async addCurrentSyncDiscarded(e,t,n,o){try{if("history"===e)return;const a=(0,i.Z)({},this.getBaseObject(),{verb:e,entity:t,data:JSON.stringify(n),type:"sync",indexType:"client-errors"},o?{error:JSON.stringify(o)}:{});await this.sendRequest(JSON.stringify(a))}catch(e){var a;null==(a=this.logger)||a.log("Could not send sync error to LS")}}queuePayload(e){this.configuration.isEnabled&&this.payloads.push(e)}queueClickEventPayload(e){this.configuration.isEnabled&&this.clickEventPayloads.push(e)}sendPayloads(e){if(this.configuration.isEnabled){if(this.payloads.length>0){let t,n="";for(const e of this.payloads)n+=JSON.stringify(e)+"\n";e&&e.isFlushBeforePageClose&&(t={useBeacon:e.isFlushBeforePageClose}),this.sendRequest(n,t),this.clearPayloads()}}else this.clearPayloads()}clearClickPayloads(){this.clickEventPayloads=[]}sendClickEventPayloads(e){if(this.configuration.isEnabled){if(this.payloads.length>0){let t,n="";for(const e of this.clickEventPayloads)n+=JSON.stringify(e)+"\n";null!=e&&e.isFlushBeforePageClose&&(t={useBeacon:e.isFlushBeforePageClose}),this.sendRequest(n,t,!0),this.clearClickPayloads()}}else this.clearClickPayloads()}sendRequest(e,t,i){var o,a;const r=i?null==(o=this.configuration)?void 0:o.clickAnalyticsUrl:this.configuration.analyticsUrl;let s;var l;if(!r)return void(null==(l=this.logger)||l.error("Can not send the analytics event, the URL is empty. Please check the configuration of analytics-service"));try{s=btoa(e)}catch(t){var c;return void(null==(c=this.logger)||c.error("Could not run btoa on reqBodyText: "+e))}let u;null!=t&&t.useBeacon&&"function"==typeof(null==(a=navigator)?void 0:a.sendBeacon)&&(u=navigator.sendBeacon(r,s)),u||("function"==typeof fetch?fetch:n(34911))(r,{method:"POST",headers:{"Content-Type":"text/plain"},body:s,credentials:"omit"})}clearPayloads(){this.payloads=[]}sendEventImmediately(e){try{const t=this.extendEventWithBaseObject(e),n=JSON.stringify(t);this.sendRequest(n)}catch(e){var t;null==(t=this.logger)||t.error(null==e?void 0:e.message,e)}}},r={addEvent:function(e,t,n,i,o,r){return a.addCurrentEvent({category:e,action:t,label:n,value:i,meta:o},{noActiveWorkspace:null==r?void 0:r.noActiveWorkspace})},addEventV2:function(e,t){return a.addCurrentEvent(e,{noActiveWorkspace:null==t?void 0:t.noActiveWorkspace})},addEventV2AndPublish:function(e,t={}){this.addEventV2(e,t),a.sendPayloads()}};var s=n(88876);const l=e=>{window.newrelic.addPageAction("InitialLoadMetrics",(0,i.Z)({route:window.location.pathname,userId:"0"},e))},c=e=>{try{a.configure(e),null==(n=window.newrelic)||null==n.setCustomAttribute||n.setCustomAttribute("postman-app-type","distributed-frontend"),(()=>{if(!window.newrelic)throw new Error("New Relic not initialized");(0,s.onTTFB)((({value:e})=>e&&l({timeToFirstByte:e}))),(0,s.onFCP)((({value:e})=>e&&l({firstContentfulPaint:e}))),(0,s.onLCP)((({value:e})=>e&&l({largestContentfulPaint:e}))),(0,s.onFID)((({value:e})=>e&&l({firstInputDelay:e}))),(0,s.onCLS)((({value:e})=>e&&l({cumulativeLayoutShift:e})))})()}catch(n){var t;null==e||null==(t=e.logger)||t.error("Analytics initialization error:",n)}var n}},34911:(e,t,n)=>{var i=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("unable to locate global object")}();e.exports=t=i.fetch,i.fetch&&(t.default=i.fetch.bind(i)),t.Headers=i.Headers,t.Request=i.Request,t.Response=i.Response}}]);
//# sourceMappingURL=8183.274449b2236562cc.js.map