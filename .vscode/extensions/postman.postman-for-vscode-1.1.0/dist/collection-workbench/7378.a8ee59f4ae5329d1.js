"use strict";(self.webpackChunkcollection_workbench=self.webpackChunkcollection_workbench||[]).push([[7378],{27378:(e,t,i)=>{i.r(t),i.d(t,{ACTION_TYPES:()=>u,ANALYTICS_ACTION:()=>h,ENTITY_TYPE:()=>d,InviteToWorkspaceForm:()=>Ht,ROLE_TYPE:()=>c,SHARE_ACTIONS:()=>p,SHARE_SUPPORTED_MODEL:()=>m,ShareButton:()=>Kt,generateInviteLink:()=>l,generateInvitePayloadTarget:()=>N,getActionData:()=>j,getActionForAnalytics:()=>D,getActionTypeAndData:()=>C,getEntityUrl:()=>O,getPermissionForEntity:()=>A,inviteViaEmail:()=>a,shareEntityWithTeamUser:()=>r});var n=i(45860),o=i(26663),s=i.n(o);const a=async(e,t)=>{const i=Object.assign({emails:e.users},e.target&&{target:e.target},e.type&&{type:e.type});return await n.postmanGateway.post({url:`${s().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:`/api/organizations/${e.teamId}/invites`,query:{user_id:e.userId},service:"god",data:{body:i},signal:t})},r=async(e,t)=>await n.postmanGateway.post({url:`${s().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:"/invite-requests",service:"collaboration",data:{body:e},signal:t}),l=async(e,t)=>await n.postmanGateway.put({url:`${s().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:`/api/organizations/${e.meta.teamId}/invites/generate_link`,service:"god",data:{body:{target:e}},signal:t});let d=function(e){return e.user="user",e.team="team",e.group="group",e}({}),c=function(e){return e.WORKSPACE_EDITOR="WORKSPACE_EDITOR",e.WORKSPACE_VIEWER="WORKSPACE_VIEWER",e.WORKSPACE_EDITOR_V9="WORKSPACE_EDITOR_V9",e.WORKSPACE_VIEWER_V9="WORKSPACE_VIEWER_V9",e.WORKSPACE_ANONYMOUS_EXPLORER="WORKSPACE_ANONYMOUS_EXPLORER",e.WORKSPACE_EXPLORER="WORKSPACE_EXPLORER",e}({}),p=function(e){return e.workspace_share_link="workspace:share_link",e.workspace_add_roles="workspace:add_role",e.workspace_share_public_link="workspace:share_public_link",e.collection_share_link="workspace:share_link::collection:share_link",e.collection_add_roles="workspace:add_role::collection:add_role",e.collection_share_public_link="workspace:share_public_link::collection:share_public_link",e.api_share_link="workspace:share_link::api:share_link",e.api_add_roles="workspace:add_role::api:add_role",e.api_share_public_link="workspace:share_public_link::api:share_public_link",e.environment_share_link="workspace:share_link::environment:share_link",e.environment_add_roles="workspace:add_role::environment:add_role",e.environment_share_public_link="workspace:share_public_link::environment:share_public_link",e}({}),u=function(e){return e.workspace_share_link="workspace:share_link",e.workspace_add_roles="workspace:add_role",e.workspace_share_public_link="workspace:share_public_link",e.collection_share_link="collection:share_link",e.collection_add_roles="collection:add_role",e.collection_share_public_link="collection:share_public_link",e.api_share_link="api:share_link",e.api_add_roles="api:add_role",e.api_share_public_link="api:share_public_link",e.environment_share_link="environment:share_link",e.environment_add_roles="environment:add_role",e.environment_share_public_link="environment:share_public_link",e}({}),m=function(e){return e.workspace="workspace",e.collection="collection",e.api="api",e.environment="environment",e.request="request",e.folder="folder",e.example="example",e}({}),h=function(e){return e.workspace_viewer="invite_ws:by_viewer",e.workspace_editor="invite_ws:by_editor",e.workspace_visitor="invite_ws:by_visitor",e.element_viewer="share_element:by_viewer",e.element_editor="share_element:by_editor",e.element_visitor="share_element:by_visitor",e}({});const v={[m.workspace]:{shareLink:{action:p.workspace_share_link,actionDataKeys:[u.workspace_share_link]},addRolesShare:{action:p.workspace_add_roles,actionDataKeys:[u.workspace_add_roles]},sharePublicLink:{action:p.workspace_share_public_link,actionDataKeys:[u.workspace_share_public_link]}},[m.collection]:{shareLink:{action:p.collection_share_link,actionDataKeys:[u.workspace_share_link,u.collection_share_link]},addRolesShare:{action:p.collection_add_roles,actionDataKeys:[u.workspace_add_roles,u.collection_add_roles]},sharePublicLink:{action:p.collection_share_public_link,actionDataKeys:[u.workspace_share_public_link,u.collection_share_public_link]}},[m.request]:{shareLink:{action:p.collection_share_link,actionDataKeys:[u.workspace_share_link,u.collection_share_link]},addRolesShare:{action:p.collection_add_roles,actionDataKeys:[u.workspace_add_roles,u.collection_add_roles]},sharePublicLink:{action:p.collection_share_public_link,actionDataKeys:[u.workspace_share_public_link,u.collection_share_public_link]}},[m.folder]:{shareLink:{action:p.collection_share_link,actionDataKeys:[u.workspace_share_link,u.collection_share_link]},addRolesShare:{action:p.collection_add_roles,actionDataKeys:[u.workspace_add_roles,u.collection_add_roles]},sharePublicLink:{action:p.collection_share_public_link,actionDataKeys:[u.workspace_share_public_link,u.collection_share_public_link]}},[m.example]:{shareLink:{action:p.collection_share_link,actionDataKeys:[u.workspace_share_link,u.collection_share_link]},addRolesShare:{action:p.collection_add_roles,actionDataKeys:[u.workspace_add_roles,u.collection_add_roles]},sharePublicLink:{action:p.collection_share_public_link,actionDataKeys:[u.workspace_share_public_link,u.collection_share_public_link]}},[m.api]:{shareLink:{action:p.api_share_link,actionDataKeys:[u.workspace_share_link,u.api_share_link]},addRolesShare:{action:p.api_add_roles,actionDataKeys:[u.workspace_add_roles,u.api_add_roles]},sharePublicLink:{action:p.api_share_public_link,actionDataKeys:[u.workspace_share_public_link,u.api_share_public_link]}},[m.environment]:{shareLink:{action:p.environment_share_link,actionDataKeys:[u.workspace_share_link,u.environment_share_link]},addRolesShare:{action:p.environment_add_roles,actionDataKeys:[u.workspace_add_roles,u.environment_add_roles]},sharePublicLink:{action:p.environment_share_public_link,actionDataKeys:[u.workspace_share_public_link,u.environment_share_public_link]}}},_={collection:"collection",extensibleCollection:"collection",environment:"environment",api:"API",monitor:"monitor",workspace:"workspace",mock:"mock server",request:"request",folder:"folder"},g="go",y={WORKSPACE_EDITOR:"Editor",WORKSPACE_VIEWER:"Viewer",WORKSPACE_EDITOR_V9:"Editor",WORKSPACE_VIEWER_V9:"Viewer",WORKSPACE_ANONYMOUS_EXPLORER:"Viewer",WORKSPACE_EXPLORER:"Viewer"},b=(e,t)=>t?`Move this ${e} to a new private workspace`:`Move this ${e} to a new team workspace`,w=(e,t)=>t?`Only this ${e} will be shared with invited people.`:`Only this ${e} will be shared with your team.`,k=()=>"move_to_new_workspace",f=(e,t)=>t?"Change the visibility of this workspace to private":"Change the visibility of this workspace to team",I=(e,t)=>t?"Everything in this workspace will be shared with invited people.":"Everything in this workspace will be shared with your team.",x=()=>"convert_workspace",E="move_to_new_workspace";function R(e,t){return t.split(".").reduce(((e,t)=>null==e?void 0:e[t]),e)}function S(e,t,i){return[...e].sort(((e,n)=>{for(const[o,s]of t.entries()){const t=i[o],a=R(e,s),r=R(n,s);if(a<r)return"desc"===t?1:-1;if(a>r)return"desc"===t?-1:1}return 0}))}const T=(e,t,i)=>Array.isArray(e)?0===e.length?i:e.reduce(((e,i,n,o)=>t(e,i,n,o)||e),i):"object"==typeof e?0===Object.keys(e).length?i:Object.keys(e).reduce(((i,n,o,s)=>t(i,e[n],n,s)||i),i):i,j=(e,t,i,n,o,s,a,r,l)=>o.reduce(((o,d)=>s&&d.includes(m.workspace)&&a?(o[d]=Object.assign({model:m.workspace,modelId:a.id},n&&{role:a.role}),o):(o[d]=Object.assign({model:e,modelId:t},l&&{activeEnvironment:l},n&&{role:i},r&&{subEntityId:r.subEntityId,subEntityModel:r.subEntityModel,subEntityName:r.subEntityName}),o)),{}),C=e=>{const{model:t,modelId:i,canUpdateRoles:n,role:o,addWorkspaceContext:s,workspaceDetails:a,sharePublicContext:r,subEntityInfo:l,activeEnvironment:d}=e;let c,p,u;return r?(c=v[t].sharePublicLink.action,p=v[t].sharePublicLink.actionDataKeys,u=!1):n?(c=v[t].addRolesShare.action,p=v[t].addRolesShare.actionDataKeys,u=!0):(c=v[t].shareLink.action,p=v[t].shareLink.actionDataKeys,u=!1),{action:c,actionData:j(t,i,o,u,p,s,a,l,d)}},O=(e,t,i,n,o,a)=>{const r=`https://${o}${s().ARTEMIS_URL.replace("https://go","")}`,l=((e,t)=>{let i=t.slice(0,31);return i=i.replace(/\s+/g,"-"),i=i.replace(/~/g,"-"),i=encodeURIComponent(i),`${i}~${e}`})(n.id,n.name);if("workspace"===t)return`${r}/workspace/${l}`;const d=!!a;return`${r}/workspace/${l}/${t}/${e}?${new URLSearchParams(Object.assign({},{action:"share",creator:i},d&&{"active-environment":a})).toString()}`},N=(e,t,i,n,o,s,a,r,l,d,c)=>{if(!a)throw new Error("Workspace info not found");const{action:p,actionData:u}=C({model:e,modelId:t,canUpdateRoles:d,role:l,addWorkspaceContext:e!==m.workspace,workspaceDetails:{id:a.id,role:r}}),h={continue_url:"",meta:{},notification_vars:{}};var v;return h.continue_url=O(t,e,o,a,s,c),h.meta={action:p,actionData:u,actorId:o,teamId:n},h.notification_vars=Object.assign({},d&&{role_name:l},{model_name_label:(v=e,v.charAt(0).toUpperCase()+v.slice(1)),model_name:m.workspace,object_name:i,visibility:null==a?void 0:a.visibilityStatus,context:e!==m.workspace}),h},A=(e,t)=>({collection:{update:"UPDATE_COLLECTION_ROLES"},environment:{update:"UPDATE_ENVIRONMENT_ROLES"},folder:{update:"UPDATE_FOLDER_ROLES"},request:{update:"UPDATE_REQUEST_ROLES"},workspace:{update:"UPDATE_WORKSPACE_ROLES"}}[e][t]),D=(e,t)=>e===m.workspace?t.includes("share_link")?h.workspace_viewer:t.includes("add_role")?h.workspace_editor:h.workspace_visitor:t.includes("share_link")?h.element_viewer:t.includes("add_role")?h.element_editor:h.element_viewer;var L=i(40540),P=i.n(L),V=i(59530),W=i.n(V),U=i(20856),Z=i(80429),M=i(16185),K=i(69019),$=i(16669),B=i(21180),G=i(35736),Y=i(52322);const z=W().div.withConfig({displayName:"loading-indicator__SpinnerContainer",componentId:"sc-1azz2oi-0"})(["display:flex;align-items:center;justify-content:center;"]);function F(){return(0,Y.jsx)(z,{children:(0,Y.jsx)(G.Z,{})})}var H=i(14350),q=i(80346),X=i(29342),Q=i(10099),J=i(22833),ee=i.n(J),te=i(74269),ie=i(91214),ne=i(37110),oe=i(58560),se=i(63622),ae=i(81397),re=i(72372),le=i(11437),de=i(24867);const ce=({userId:e})=>{const{data:t,isLoading:i}=(0,$.usePublicProfile)({userIds:[`${e}`],type:"user"}),n=null==t?void 0:t[e],o=(null==n?void 0:n.name)||(null==n?void 0:n.username)||(null==n?void 0:n.email);return i?(0,Y.jsx)(F,{}):(0,Y.jsxs)("div",{className:"permission-list-item__members-list__content__item",children:[(0,Y.jsx)(ie.Z,{size:"s",src:null==n?void 0:n.profile_pic_url}),(0,Y.jsx)("div",{className:"permission-list-item__members-list__content__item__name",title:o,children:o})]})},pe=W().div.withConfig({displayName:"role-dropdown-option__StyledContainer",componentId:"sc-tbprja-0"})(["display:flex;flex-direction:column;gap:var(--spacing-s);min-width:max-content;height:",";color:",";opacity:",";:hover{cursor:",";}"],(({isDestructive:e})=>e&&"32px"),(({isDestructive:e})=>e&&"var(--content-color-error)"),(({isDisabled:e})=>e?"0.5":"1"),(({isDisabled:e})=>e?"default":"pointer")),ue=W().div.withConfig({displayName:"role-dropdown-option__StyledDescriptionContainer",componentId:"sc-tbprja-1"})(["width:fit-content;"]),me=({label:e,description:t,isDestructive:i,state:n})=>{var o;const s=null==n?void 0:n.isBlocked.status,a=s?ae.Z:P().Fragment;return(0,Y.jsx)(a,{placement:"bottom",content:s?null==n||null==(o=n.isBlocked)?void 0:o.detail:"",children:(0,Y.jsxs)(pe,{"data-testid":"role-dropdown-option",isDestructive:i,isDisabled:s,children:[(0,Y.jsx)(se.ZP,{typographyStyle:{fontSize:"text-size-m",fontWeight:"text-weight-regular",lineHeight:i?"line-height-xxl":"line-height-m"},children:e}),t&&(0,Y.jsx)(ue,{children:(0,Y.jsx)(se.ZP,{color:"content-color-secondary",typographyStyle:{fontSize:"text-size-s",fontWeight:"text-weight-regular",lineHeight:"line-height-s"},children:t})})]})})},he=W().div.withConfig({displayName:"roles-list-item__StyledDropdownContainer",componentId:"sc-1efnpd5-0"})(["display:flex;padding-left:var(--spacing-s);align-items:center;float:right;margin-left:auto;"]),ve=W()(te.Z).withConfig({displayName:"roles-list-item__StyledSingleSelect",componentId:"sc-1efnpd5-1"})([".aether-dropdown__menu{width:fit-content !important;}.aether-dropdown__control--is-disabled{background-color:var(--background-color-primary);border:none;&--is-focused{border:none;box-shadow:none;&:hover{border-right:none;border:none;}}&:hover{border:none;transition:none;-webkit-transition:none;}}"]),_e=(0,L.memo)((({infoText:e,selectedRole:t,rolesList:i,orderedRoleList:n,member:o,subTitle:s,isTeam:a,isGuest:r,isPartner:l,canModifyMembers:d,isUserGroup:c,onChange:p,onRemove:u,teamData:m,dataTestId:h,canManageRolesOnEntity:v})=>{const _=(0,L.useRef)(null),[g,y]=(0,L.useState)({value:t,label:t}),[b,w]=(0,L.useState)(0),[k,f]=(0,L.useState)(""),[I,x]=(0,L.useState)([]),E=o.isPlaceholder;(0,L.useEffect)((()=>{var e;t!==g.label&&y({value:t,label:(null==(e=i[t])?void 0:e.displayName)||t})}),[t]);const R=d&&("boolean"!=typeof o.canRemove||o.canRemove);return(0,L.useEffect)((()=>{var e,t;const i=null==m||null==(e=m.user_groups)?void 0:e.find((e=>`${e.id}`==`${o.id}`));w((null==m||null==(t=m.user_groups)?void 0:t.length)||0),f(`${b} member${b>1?"s":""}`),x((null==i?void 0:i.members)||[])}),[m,o,b]),(0,Y.jsxs)(Y.Fragment,{children:[c&&_.current&&(0,Y.jsxs)(U.ZP,{triggerRef:_,triggerEvent:"click",placement:"left",padding:"spacing-xl",pointer:!0,children:[(0,Y.jsxs)("div",{className:"permission-list-item__members-list__title",children:[(0,Y.jsx)("div",{className:ee()({"permission-list-item__members-list__title__group-name":!0,"permission-list-item__members-list__title__no-members":!b}),title:o.name,children:o.name})," ",b>0&&(0,Y.jsxs)("div",{children:["(",k,")"]})]}),(0,Y.jsx)("div",{className:ee()({"permission-list-item__members-list__content":!0,"permission-list-item__members-list__no-members":!b}),children:b>0?I.map((e=>(0,Y.jsx)(ce,{userId:e},e))):(0,Y.jsx)("div",{className:"permission-list-item__members-list__content__no-members",children:(0,Y.jsx)(ne.Z,{type:"secondary",text:"No members in this group."})})})]}),(0,Y.jsxs)("div",{className:"permission-list-item-v2","data-testid":h,children:[(0,Y.jsxs)("div",{ref:_,className:"permission-list-item-v2-container",children:[E?o.icon:c?(0,Y.jsx)(le.Z,{className:"permission-list-item__user-group",color:"content-color-secondary"}):(0,Y.jsx)(ie.Z,{src:o.profile_pic_url,size:"s",userId:o.id}),(0,Y.jsxs)("div",{className:ee()({"permission-list-item--name":!0,"permission-list-item--name__user-group":c}),children:[(0,Y.jsxs)(oe.Z,{gap:"spacing-s",alignItems:"center",children:[(0,Y.jsx)(se.ZP,{color:"content-color-primary",isTruncated:!0,children:o.name}),r&&(0,Y.jsx)(ae.Z,{content:"Guests can only view collections shared with them.",placement:"right",children:(0,Y.jsx)("div",{children:(0,Y.jsx)(re.Z,{text:"Guest",color:"grey"})})}),l&&(0,Y.jsx)(re.Z,{text:"Partner",color:"grey"})]}),s&&(0,Y.jsx)(se.ZP,{color:"content-color-secondary",children:s})]})]}),(0,Y.jsxs)(he,{children:[e&&(0,Y.jsx)("div",{className:"permission-list-item--info","data-testid":"role-list-item-info-text",children:(0,Y.jsx)(ae.Z,{content:e,maxWidth:300,placement:"left",children:(0,Y.jsx)(de.Z,{})})}),(0,Y.jsx)("div",{className:(S=R,ee()({"permissions-list-item--permissions":!0,"permission-list-item--user":!0,"can-remove":S})),children:(0,Y.jsx)(ve,{onChange:e=>{var t;if(null!=(t=e.state)&&null!=(t=t.isBlocked)&&t.status)return;let i="user";if(c&&(i="group"),a&&(i="team"),"remove"===e.value)return null==u?void 0:u(i,o.id);p&&p(o.id,i,e.value)},options:(()=>{const e=n.map((e=>Object.assign({},e,{label:e.displayName,value:e.name,isDestructive:!1,state:e.state})));return R&&e.push({displayName:"Remove",description:"",isEnabled:!0,name:"Remove",permissions:[],state:{isBlocked:{status:!1,detail:"You don’t have permission to perform this action"},isInvalid:{status:!1,detail:"You don’t have permission to perform this action"}},label:"Remove",value:"remove",isDestructive:!0}),e})(),value:g,customOptionComponent:me,isClearable:!1,isSearchable:!1,triggerType:"tertiary",triggerWidth:"auto",menuPlacement:"bottom-end",menuMaxWidth:500,dataTestId:"role-list-item-roles-dropdown",isDisabled:!v||!o.id})})]})]})]});var S})),ge=W().div.withConfig({displayName:"roles-list__StyledIconContainer",componentId:"sc-1gp781x-0"})(["display:flex;align-items:center;justify-content:center;height:var(--size-s);width:var(--size-s);"]),ye=({fallbackRole:e,canModifyMembers:t,selectedUserRoles:i,selectedUserGroupsRoles:n,rolesList:o,guestRoles:s,partnerRoles:a,orderedRoleList:r,orderedGuestRoleList:l,orderedPartnerRoleList:d,teamRole:c,members:p,userGroups:u,entityType:m,roleValidations:h,teamData:v,onChange:g,onRemove:y,canManageRolesOnEntity:b,workspaceVisibility:w})=>{const k=(t,i,n)=>{var r;let l;return l=i?s:n?a:o,(null==(r=l)||null==(r=r[t])?void 0:r.displayName)||e},f=(e,t)=>{var i;return!1===(null==(i=h[`${e}_${t}`])?void 0:i.valid)?"user"===e?`This ${e} has edit permission on this ${_[m]} which they are inheriting from the workspace or a group.`:`This ${e} has edit permission on this ${_[m]} which they are inheriting from the workspace.`:""},I=p.map((e=>(({id:e,canRemove:t})=>{var i;if((0,$.isUserGuest)(e,v)){var n;const i=null==v||null==(n=v.guest_members)?void 0:n.find((t=>t.id===e));return{id:e,name:(null==i?void 0:i.name)||(null==i?void 0:i.username)||(null==i?void 0:i.email)||"",email:(null==i?void 0:i.email)||"",canRemove:t,profile_pic_url:null==i?void 0:i.profile_pic_url}}if((0,$.isUserPartner)(e,v)){var o;const i=null==v||null==(o=v.partner_members)?void 0:o.find((t=>t.id===e));return{id:e,name:(null==i?void 0:i.name)||(null==i?void 0:i.username)||(null==i?void 0:i.email)||"",email:(null==i?void 0:i.email)||"",canRemove:t,profile_pic_url:null==i?void 0:i.profile_pic_url}}const s=null==v||null==(i=v.team_users)?void 0:i.find((t=>t.id===e));return{id:e,name:(null==s?void 0:s.name)||(null==s?void 0:s.username)||(null==s?void 0:s.email)||"",email:(null==s?void 0:s.email)||"",canRemove:t,profile_pic_url:null==s?void 0:s.profile_pic_url}})(e)));return(0,Y.jsx)("div",{className:"permission-list-v2-container",children:(0,Y.jsxs)("div",{className:"permission-list",children:[(()=>{const e=Object.keys(c||{}).length>0&&(null==v?void 0:v.name);if(!v)return null;if(w===Q.VISIBILITY_STATUS.team){var t;const i={id:null==c?void 0:c.id,name:e?`Everyone at ${e} team`:"Everyone at team",canRemove:!1,totalMembers:null==v||null==(t=v.team_users)?void 0:t.length,profile_pic_url:null==v?void 0:v.logo_url};return(0,Y.jsx)(_e,{canManageRolesOnEntity:b,infoText:f("team",null==c?void 0:c.id),selectedRole:k(null==c?void 0:c.name),rolesList:o,orderedRoleList:r,member:i,onChange:g,subTitle:i.totalMembers>1?`${i.totalMembers} team members`:"1 team member",teamData:v,isTeam:!0,dataTestId:"team-role-list-item"},i.id)}var i,n;return w===Q.VISIBILITY_STATUS.private?(0,Y.jsx)(_e,{infoText:"",selectedRole:"Viewer",rolesList:o,orderedRoleList:r,member:{id:v.id,name:"Only invited people from the team",canRemove:!1,totalMembers:null==(i=v.team_users)?void 0:i.length,profile_pic_url:"",isPlaceholder:!0,icon:(0,Y.jsx)(ge,{children:(0,Y.jsx)(q.Z,{})})},onChange:g,subTitle:"",teamData:v,isTeam:!0,dataTestId:"team-role-list-item"},"placeholder-team"):w===Q.VISIBILITY_STATUS.public?(0,Y.jsx)(_e,{infoText:"",selectedRole:"Viewer",rolesList:o,orderedRoleList:r,member:{id:v.id,name:"Anyone on the internet",canRemove:!1,totalMembers:null==(n=v.team_users)?void 0:n.length,profile_pic_url:"",isPlaceholder:!0,icon:(0,Y.jsx)(ge,{children:(0,Y.jsx)(X.Z,{})})},onChange:g,subTitle:"",teamData:v,isTeam:!0,dataTestId:"team-role-list-item"},"placeholder-team"):null})(),Object.keys(u).map((e=>{const i=u[e],s=(a=i.id,null==(l=n[a])?void 0:l.name);var a,l;return(0,Y.jsx)(_e,{canManageRolesOnEntity:b,infoText:f("group",i.id),canModifyMembers:t,selectedRole:k(s),rolesList:o,orderedRoleList:r,member:i,onChange:g,teamData:v,onRemove:y,subTitle:i.members.length>1?`${i.members.length} group members`:"1 group member",dataTestId:"user-group-role-list-item",isUserGroup:!0},i.id)})),I.map((e=>{const n=(0,$.isUserGuest)(e.id,v),s=(0,$.isUserPartner)(e.id,v),a=(c=e.id,null==(p=i[c])?void 0:p.name);var c,p;let u=[];return u=n?l:s?d:r,(0,Y.jsx)(_e,{canManageRolesOnEntity:b,infoText:f("user",e.id),canModifyMembers:t,selectedRole:k(a,n,s),rolesList:o,orderedRoleList:u,member:e,onChange:g,onRemove:y,subTitle:e.email,isGuest:n,isPartner:s,teamData:v,dataTestId:"user-role-list-item"},e.id)}))]})})},be=(0,L.createContext)({}),we=({children:e})=>{const[t,i]=(0,L.useState)({name:"No Environment",id:"No Environment"}),[n,o]=(0,L.useState)([]),[s,a]=(0,L.useState)({}),[r,l]=(0,L.useState)([]),[d,c]=(0,L.useState)(!1),[p,u]=(0,L.useState)(),{data:m,isLoading:h}=(0,Q.useActiveWorkspaceInfo)();return(0,L.useEffect)((()=>{m&&u(m.visibilityStatus)}),[h,m]),(0,Y.jsx)(be.Provider,{value:{selectedInvitees:n,setSelectedInvitees:o,selectedRole:s,setSelectedRole:a,roleOptions:r,setRoleOptions:l,isRoleOptionsLoading:d,setIsRoleOptionsLoading:c,selectedEnvironment:t,setSelectedEnvironment:i,getInvalidEmailCount:()=>n.filter((e=>e.isInvalid)).length,workspaceInfo:m,isWorkspaceInfoLoading:h,workspaceVisibility:p,setWorkspaceVisibility:u},children:e})};var ke=i(53186),fe=i(98276);const Ie=(0,L.memo)((({canModifyMembers:e,entityType:t,entityId:i,teamData:n,rolesResponse:o,rolesForObjectTypeResponse:s,defaultRolesResponse:a,canManageRolesOnEntity:r,workspaceRoles:l,workspaceVisibility:d})=>{const{setRoleOptions:c,setSelectedRole:p,selectedRole:u}=(0,L.useContext)(be),[h,v]=(0,L.useState)({}),[_,g]=(0,L.useState)({}),[b,w]=(0,L.useState)({}),[k,f]=(0,L.useState)({}),[I,x]=(0,L.useState)([]),[E,R]=(0,L.useState)({}),[j,C]=(0,L.useState)({}),[O,N]=(0,L.useState)({}),[A,D]=(0,L.useState)([]),[P,V]=(0,L.useState)({}),W=(()=>{const e=(0,ke.useUpdateCollectionRoles)(),t=(0,fe.useUpdateEnvironmentRoles)(),{addToast:i}=(0,K.ZP)(),n=e=>{i({status:"error",description:`Could not update the roles on this ${e}. Please try again.`})};return(i,o,s,a,r)=>{const l=(0,H.getRolesData)(i,o,s,a,r);switch(i){case m.collection:e.mutate({collectionId:o,roles:l},{onError:()=>n(i)});break;case m.environment:t.mutate({environmentId:o,roles:l},{onError:()=>n(i)})}}})(),U=(0,H.useFetchAssociatedRoles)(),Z=null==n?void 0:n.id,M=async e=>{const n={},o=Object.assign({},O);if(e.length>0){for(const o of e){const{memberType:e,memberId:s,role:a}=o;n[`${e}_${s}`]={entityId:s,entityType:e,objectId:i,objectType:t,role:a}}try{const e=await(0,H.validateRolesAssignment)({validationCriteria:n});N(Object.assign({},o,e.results))}catch(e){}}},$=e=>I.reduce(((t,i)=>{const n=null==e?void 0:e[i];return n&&t.push(n),t}),[]),B=(e,n,o)=>{W(t,i,e,n,o)};return(0,L.useEffect)((()=>{let e={};const{defaultRoles:i,rolesList:r,userCurrentRoles:m,teamCurrentRoles:h,groupCurrentRoles:_,rolesOrder:b,guestRoles:k,partnerRoles:I}=U(t,o,s,null==a?void 0:a.data);var E;0===Object.keys(h).length&&"team"===d&&(e=T(null==l||null==(E=l.listing)?void 0:E.team,((e,t,i)=>{var n;const o=y[null==t||null==(n=t.roles)?void 0:n[0]];if(o){const[,t]=Object.entries(r).find((([,e])=>e.displayName===o))||[];e[i]={type:"team",id:i,name:null==t?void 0:t.name}}return e}),{})),v(r),g(m),w(_),x(b),R(k),C(I),f(h[Z]||e[Z]);const j=Object.assign({},m,h,_),O=[];for(const[e,t]of Object.entries(j))O.push({memberType:t.type,memberId:e,role:t.name});M(O);const N=(null==n?void 0:n.user_groups)||[],{userGroupRoles:A}=(0,H.segregateGroupRoles)(_,N),L=(0,H.getUserGroupsFromRoles)(A,N),P=Object.keys(m).map((e=>({id:e})));D(P),V(L);const W=S(b.reduce(((e,t)=>{const i=r[t];return i&&e.push(i),e}),[]),["state.isBlocked.status"],["asc"]);c(W.map((e=>({label:e.displayName,value:e.name,state:e.state}))));const K=W.find((e=>e.name===i.user));u.label||p({label:(null==K?void 0:K.displayName)||W[0].displayName,value:(null==K?void 0:K.name)||W[0].name})}),[o,l]),(0,Y.jsx)("div",{className:"modify-permissions-body","data-testid":"manage-roles-container",children:(0,Y.jsx)("div",{className:"modify-permissions",children:(0,Y.jsx)("div",{className:"modify-permissions--editor",children:(0,Y.jsx)("div",{className:"modify-permissions--roles-container",children:(0,Y.jsx)(ye,{fallbackRole:"Select Role",canModifyMembers:e,selectedUserRoles:_,selectedUserGroupsRoles:b,rolesList:h,guestRoles:E,partnerRoles:j,orderedRoleList:S($(h),["state.isBlocked.status"],["asc"]),orderedGuestRoleList:S($(E),["state.isBlocked.status"],["asc"]),orderedPartnerRoleList:S($(j),["state.isBlocked.status"],["asc"]),disabledRoleTooltipText:`You can only assign users an ${T(h,((e,t)=>(t.isEnabled&&e.push(t.displayName),e)),[]).join(" ,")} role on this ${t}. Your plan doesn’t include access management.`,teamRole:k,members:A,userGroups:P,onChange:async(e,t,i)=>{const n=Object.assign({},_),o=Object.assign({},b);let s=Object.assign({},k);switch(t){case"user":n[e]={id:e,type:t,name:i},g(n);break;case"group":o[e]={id:e,type:t,name:i},w(o);break;case"team":s={type:t,id:Z,name:i},f(s)}M([{memberType:t,memberId:e,role:i}]),B(n,o,s)},onRemove:(e,t)=>{const i=Object.assign({},_),n=Object.assign({},b);switch(e){case"user":{const e=A.filter((e=>e.id!==t));delete i[t],g(i),D(e);break}case"group":{const e=Object.assign({},P);delete n[t],delete e[t],w(n),V(e);break}}M([]),B(i,n,k)},entityType:t,entityId:i,roleValidations:O,teamData:n,canManageRolesOnEntity:r,workspaceVisibility:d})})})})})})),xe=(0,L.memo)((({entityType:e,entityId:t,canManageRolesOnEntity:i,workspaceVisibility:n,isWorkspaceInfoLoading:o})=>{const{setIsRoleOptionsLoading:s}=(0,L.useContext)(be),{data:a,isLoading:r,isRefetching:l}=(0,H.useFetchDefaultRolesForObjectType)(e,!0,!0),{data:d,isLoading:c}=(0,H.useFetchRolesForObject)(e,t,!0,!0),{data:p,isLoading:u,isRefetching:m}=(0,H.useFetchRolesForObjectType)(e,!0,!0),{data:h,isLoading:v,isRefetching:_}=(0,$.useTeamsByUserId)(),g=(0,Q.useActiveWorkspaceId)(),{data:y,isLoading:b,isRefetching:w}=(0,Q.useWorkspaceRoles)(g),k=r||c||u||v||b||o||l||m||w||_;return(0,L.useEffect)((()=>{s(k)}),[k]),k?(0,Y.jsx)(F,{}):(0,Y.jsx)(B.CustomErrorBoundary,{appId:"collaboration-service",errorElementId:"manage-roles-container",fallback:(0,Y.jsx)(B.GenericErrorMessage,{title:`Coundn't load roles for the ${e}`,description:"Just a faulty wire. Try reloading.",illustration:"illustration-internal-server-error"}),children:(0,Y.jsx)(Ie,{canModifyMembers:!0,entityType:e,entityId:t,teamData:null==h?void 0:h.organizations[0],rolesResponse:d,rolesForObjectTypeResponse:p,defaultRolesResponse:a,canManageRolesOnEntity:i,workspaceRoles:y,workspaceVisibility:n})})}));var Ee=i(20455);const Re=W().div.withConfig({displayName:"share-with-environment__StyledContainer",componentId:"sc-ihk9ii-0"})(["display:flex;flex-direction:row;align-items:center;height:40px;padding-left:var(--spacing-xl);padding-right:var(--spacing-xl);"]),Se=W().div.withConfig({displayName:"share-with-environment__StyledEnvironmentIconContainer",componentId:"sc-ihk9ii-1"})(["display:flex;align-items:center;margin-left:var(--spacing-xs);width:var(--size-s);justify-content:center;"]),Te=W().div.withConfig({displayName:"share-with-environment__StyledEnvironmentDropdownContainer",componentId:"sc-ihk9ii-2"})(["display:flex;float:right;margin-left:auto;margin-right:var(--spacing-xs);"]),je=W().div.withConfig({displayName:"share-with-environment__StyledEnvironmentTitle",componentId:"sc-ihk9ii-3"})(["margin-left:var(--spacing-s);color:var(--content-color-primary);"]),Ce=({entityType:e})=>{const t=(0,Q.useActiveWorkspaceId)(),{selectedEnvironment:i,setSelectedEnvironment:n}=(0,L.useContext)(be),{data:o,isLoading:s}=(0,fe.useEnvironmentItems)({workspaceId:t});return(0,L.useEffect)((()=>{n({id:"No Environment",name:"No Environment"})}),[]),e!==m.collection?null:(0,Y.jsxs)(Re,{"data-testid":"share-with-environment-container",children:[(0,Y.jsx)(Se,{children:(0,Y.jsx)(Ee.Z,{})}),(0,Y.jsx)(je,{children:"Share with Environment"}),(0,Y.jsx)(Te,{children:(0,Y.jsx)(te.Z,{onChange:e=>(e=>{if("No Environment"===e.value)return void n({name:"No Environment",id:"No Environment"});const t=null==o?void 0:o.find((t=>t.id===(null==e?void 0:e.value)));n({name:t.name,id:t.id})})(e),options:(()=>{const e=[{label:"No Environment",value:"No Environment"}];for(const t of o||[])e.push({label:t.name,value:t.id});return e})(),value:{label:i.name,value:i.id},isSearchable:!1,isClearable:!1,triggerType:"tertiary",placeholder:"Select Environment",isLoading:s,menuPlacement:"bottom-end",triggerMaxWidth:"200px"})})]})},Oe=W().div.withConfig({displayName:"divider__StyledDivider",componentId:"sc-6emq1x-0"})(["height:1px;background-color:var(--border-color-default);width:100%;"]),Ne=W().div.withConfig({displayName:"divider__StyledDividerContainer",componentId:"sc-6emq1x-1"})(["height:",";padding-left:var(--spacing-xl);padding-right:var(--spacing-xl);display:flex;align-items:center;"],(e=>e.height)),Ae=({height:e})=>(0,Y.jsx)(Ne,{height:e,children:(0,Y.jsx)(Oe,{})});var De=i(38394),Le=i(95617);const Pe=({teamId:e,userId:t,entityId:i,entityType:n})=>{const{selectedEnvironment:o}=(0,L.useContext)(be),[s,a]=(0,L.useState)(!1),{data:r,isLoading:l}=(0,Q.useActiveWorkspaceInfo)(),{data:d,isLoading:c}=(0,$.useTeamsByUserId)(),p=s?(0,Y.jsx)(De.Z,{}):(0,Y.jsx)(Le.Z,{});return e&&r?(0,Y.jsx)(Z.Z,{onClick:async()=>{if(!s){a(!0);const e="No Environment"===o.id?void 0:o.id,s=(null==d?void 0:d.organizations[0].domain)||g,l=O(i,n,t,r,s,e);navigator.clipboard.writeText(l),setTimeout((()=>{a(!1)}),2e3)}},type:"tertiary",icon:p,text:"Copy Link",isLoading:l||c,"data-testid":"copy-link-button"}):null};var Ve=i(13101);const We=W().div.withConfig({displayName:"share-popover-footer__StyledContainer",componentId:"sc-10vg7le-0"})(["display:flex;height:56px;background-color:var(--background-color-secondary);border-bottom-right-radius:var(--border-radius-default);border-bottom-left-radius:var(--border-radius-default);align-items:center;margin-top:10px;"]),Ue=W().div.withConfig({displayName:"share-popover-footer__StyledCopyLinkContainer",componentId:"sc-10vg7le-1"})(["float:right;margin-left:auto;margin-right:var(--spacing-xl);"]),Ze=({entityType:e,entityId:t})=>{const i=(0,Ve.getTeamId)(),n=(0,Ve.getUserId)();return(0,Y.jsx)(We,{children:(0,Y.jsx)(Ue,{children:(0,Y.jsx)(Pe,{entityId:t,entityType:e,userId:n,teamId:i})})})},Me=()=>{const[e,t]=(0,L.useState)(""),[i,n]=(0,L.useState)({checks:{}}),{data:o,isLoading:s,isError:a,refetch:r}=(0,H.useEntityPermissions)(e,i),[l,d]=(0,L.useState)({});return(0,L.useEffect)((()=>{if(!s&&o&&o.results){const e={};for(const t in o.results)e[t]=o.results[t].allowed;d(e)}}),[s,o]),{permissionCheckResults:l,triggerPermissionChecks:(e,i)=>{t(e),n(i)},isError:a,refetch:r}};var Ke=i(88343),$e=i(56415),Be=i(36241),Ge=i(69917);const Ye=W().div.withConfig({displayName:"form-components__CurrentRoleContainer",componentId:"sc-1unbdj6-0"})(["margin-left:auto;"]),ze=e=>{const{label:t,userId:i,email:n,__isNew__:o,profile_pic_url:s}=e.userData,{isSelected:a,currentRoleDisplayName:r}=e;return(0,Y.jsxs)(oe.Z,{alignItems:"center",gap:"spacing-s",width:"100%","data-testid":"invite-user-suggestion-item",children:[o?(0,Y.jsx)(Ge.Z,{}):(0,Y.jsx)(ie.Z,{src:null!=s?s:"",userId:Number(i),size:"s"}),(0,Y.jsxs)(oe.Z,{direction:"column",grow:1,shrink:1,minWidth:"0px",children:[(0,Y.jsx)(se.ZP,{isTruncated:!0,children:t}),!a&&(0,Y.jsx)(se.ZP,{isTruncated:!0,color:"content-color-secondary",children:n})]}),!a&&r&&(0,Y.jsx)(Ye,{children:(0,Y.jsx)(se.ZP,{color:"content-color-secondary",children:r})})]})},Fe=e=>{const{isSelected:t,label:i,members:n,currentRoleDisplayName:o}=e;return(0,Y.jsxs)(oe.Z,{alignItems:"center",gap:"spacing-s",width:"100%","data-testid":"invite-group-suggestion-item",children:[(0,Y.jsx)(le.Z,{}),(0,Y.jsxs)(oe.Z,{direction:"column",children:[(0,Y.jsx)("span",{children:i}),!t&&(0,Y.jsxs)(se.ZP,{color:"content-color-secondary",children:[null==n?void 0:n.length," members"]})]}),!t&&o&&(0,Y.jsx)(Ye,{children:(0,Y.jsx)(se.ZP,{color:"content-color-secondary",children:o})})]})},He=e=>{const{label:t,desc:i}=e;return(0,Y.jsxs)(oe.Z,{direction:"column",gap:"spacing-xs","data-testid":"role-option-item",children:[(0,Y.jsx)(se.ZP,{size:"medium",children:t}),(0,Y.jsx)(se.ZP,{color:"content-color-secondary",children:i})]})},qe=e=>{var t;return null==(t=e.state)||null==(t=t.isBlocked)?void 0:t.status},Xe=e=>{var t;return qe(e)?(0,Y.jsx)(ae.Z,{content:null==(t=e.state)?void 0:t.isBlocked.detail,children:(0,Y.jsx)("div",{children:(0,Y.jsx)(He,Object.assign({},e))})}):(0,Y.jsx)(He,Object.assign({},e))},Qe=({optionData:e,userRoleMap:t,roleDropdownOptions:i,userGroupsRoleMap:n})=>{var o;const{selectedInvitees:s}=(0,L.useContext)(be),{userId:a,groupId:r,isGroup:l,email:d}=e,c=a?null==t?void 0:t[a]:r?null==n?void 0:n[r]:"",p=null==i||null==(o=i.find((e=>e.value===c)))?void 0:o.label,u=s.some((e=>l?e.value===String(r):e.value===d));if(l){const{label:t,members:i}=e;return(0,Y.jsx)(Fe,{label:t,members:i,isSelected:u,currentRoleDisplayName:p})}return(0,Y.jsx)(ze,{userData:e,isSelected:u,currentRoleDisplayName:p})};var Je=i(47503),et=i(84591),tt=i(16913);const it=W().div.withConfig({displayName:"validation-state__StyledContainer",componentId:"sc-ejqvw-0"})(["display:flex;flex-direction:row;align-items:center;gap:var(--spacing-xs);margin:var(--spacing-xs) var(--spacing-xl) var(--spacing-m) var(--spacing-xl);"]),nt={error:"content-color-error",info:"content-color-info",warning:"content-color-warning"},ot=W()(Je.Z).withConfig({displayName:"validation-state__StyledIconStateErrorStrokeSmall",componentId:"sc-ejqvw-1"})(["padding-top:2px;"]),st=W()(et.Z).withConfig({displayName:"validation-state__StyledIconStateInfoStrokeSmall",componentId:"sc-ejqvw-2"})(["padding-top:2px;"]),at=e=>"error"===e?(0,Y.jsx)(ot,{color:nt[e]}):"warning"===e?(0,Y.jsx)(tt.Z,{color:nt[e]}):(0,Y.jsx)(st,{color:nt[e]}),rt=({text:e,type:t})=>(0,Y.jsxs)(it,{children:[at(t),(0,Y.jsx)(se.ZP,{color:nt[t],typographyStyle:{fontSize:"text-size-m",fontWeight:"text-weight-regular",lineHeight:"line-height-s",fontFamily:"text-family-default"},"data-testid":"invite-dropdown-error-message",children:e})]}),lt=W().div.withConfig({displayName:"invite-dropdown__StyledContainer",componentId:"sc-vnu4n-0"})(["display:flex;flex-grow:1;flex-direction:column;"]),dt=W().div.withConfig({displayName:"invite-dropdown__StyledDropdownContainer",componentId:"sc-vnu4n-1"})(["display:flex;position:relative;align-items:center;margin:var(--spacing-xl);margin-right:var(--spacing-m);margin-bottom:",";border:",";border-radius:var(--border-radius-default);box-shadow:",";transition:border 0.2s ease-in-out,box-shadow 0.2s ease-in-out;-webkit-transition:border 0.2s ease-in-out,box-shadow 0.2s ease-in-out;& > :first-child{width:",";}.aether-dropdown__control{width:max-content;background:var(--background-color-secondary);border-left:1px solid var(--border-color-strong);border:none;border-bottom-left-radius:",";border-top-left-radius:",";&--is-focused{border:none;box-shadow:none;&:hover{border:none;}}&:hover{border:none;transition:none;-webkit-transition:none;}}.aether-multiselect-dropdown__control{border:none;border-bottom-right-radius:",";border-top-right-radius:",";&--is-focused{border:none;box-shadow:none;&:hover{border-right:none;border:none;}}&:hover{border:none;transition:none;-webkit-transition:none;}}.aether-multiselect-dropdown__menu{width:100%;}"],(({isValidationStateVisible:e})=>e?"0":"var(--spacing-m)"),(({isDropdownSelected:e,validationState:t})=>((e,t)=>"error"===t?"1px solid var(--highlight-background-color-error)":"warning"===t?"1px solid var(--highlight-background-color-warning)":"info"===t?"1px solid var(--highlight-background-color-info)":e?"1px solid var(--blue-30)":"1px solid var(--border-color-strong)")(e,t)),(({isDropdownSelected:e,validationState:t})=>((e,t)=>e?"error"===t?"0 0 0 2px var(--highlight-background-color-error)":"warning"===t?"0 0 0 2px var(--highlight-background-color-warning)":"info"===t?"0 0 0 2px var(--highlight-background-color-info)":"0 0 0 2px var(--blue-30)":"none")(e,t)),(({isRolesDropdownVisible:e})=>e?"calc(100% - 68px)":"100%"),(({isRolesDropdownVisible:e})=>e?"0px":"var(--border-radius-default)"),(({isRolesDropdownVisible:e})=>e?"0px":"var(--border-radius-default)"),(({isRolesDropdownVisible:e})=>e?"0px":"var(--border-radius-default)"),(({isRolesDropdownVisible:e})=>e?"0px":"var(--border-radius-default)")),ct=W().div.withConfig({displayName:"invite-dropdown__StyledPopoverTrigger",componentId:"sc-vnu4n-2"})(["cursor:pointer;display:flex;align-items:center;justify-content:center;background-color:var(--background-color-secondary);border-top-right-radius:var(--border-radius-default);border-bottom-right-radius:var(--border-radius-default);width:68px;position:absolute;top:0;bottom:0;right:0;.tippy-content{padding:var(--spacing-s);}"]),pt=W().div.withConfig({displayName:"invite-dropdown__StyledLoadingIndicatorContainer",componentId:"sc-vnu4n-3"})(["display:flex;align-items:center;justify-content:center;width:100%;"]),ut=W().div.withConfig({displayName:"invite-dropdown__StyledPopoverIconContainer",componentId:"sc-vnu4n-4"})(["display:flex;align-items:center;float:right;margin-left:2px;padding-right:4px;"]),mt=W().div.withConfig({displayName:"invite-dropdown__StyledRoleOptionContainer",componentId:"sc-vnu4n-5"})(["display:flex;align-items:center;height:28px;padding-left:var(--spacing-s);:hover{cursor:",";background-color:var(--background-color-tertiary);border-radius:var(--border-radius-default);}opacity:",";"],(({isDisabled:e})=>e?"default":"pointer"),(({isDisabled:e})=>e?"0.5":"1")),ht=W().div.withConfig({displayName:"invite-dropdown__StyledSelectedRoleTitle",componentId:"sc-vnu4n-6"})(["padding-left:var(--spacing-s);"]),vt=W().div.withConfig({displayName:"invite-dropdown__StyledSelectedRoleIconContainer",componentId:"sc-vnu4n-7"})(["width:16px;height:16px;margin-right:var(--spacing-s);"]),_t=W().div.withConfig({displayName:"invite-dropdown__StyledRoleOptions",componentId:"sc-vnu4n-8"})(["background-color:var(--background-color-primary);border-radius:var(--border-radius-default);padding:var(--spacing-s);"]),gt=({label:e="",placeholder:t="",permissions:i,showRoleDropdown:n=!0,className:o="",canManageRolesOnEntity:s,onChange:a})=>{var r;const{selectedInvitees:l,setSelectedInvitees:d,selectedRole:c,setSelectedRole:p,roleOptions:u,isRoleOptionsLoading:m,getInvalidEmailCount:h}=(0,L.useContext)(be),v=(0,Q.useActiveWorkspaceId)(),[_,g]=(0,L.useState)(!1),[y,b]=(0,L.useState)(!1),[w,k]=(0,L.useState)([]),[f,I]=(0,L.useState)([]),[x,E]=(0,L.useState)({}),[R,S]=(0,L.useState)({}),{data:T,isLoading:j}=(0,Q.useWorkspaceRoles)(v),C=(0,Ve.getUserId)(),{data:O,isLoading:N}=(0,$.useTeamsByUserId)({userId:C}),A=()=>l.some((e=>e.__isNew__));(0,L.useEffect)((()=>{if(!N&&O&&O.organizations[0]){const e=[],t=[];for(const t of O.organizations[0].team_users)t.id!==C&&e.push({label:t.name||t.username,value:t.email,userId:t.id,email:t.email,profile_pic_url:t.profile_pic_url});k(e);for(const e of O.organizations[0].user_groups)t.push({label:e.name,value:`${e.id}`,groupId:e.id,isGroup:!0,members:e.members});I(t)}}),[N,O,C]),(0,L.useEffect)((()=>{if(!j&&null!=T&&T.listing){const e={},t=T.listing.user||{},i=T.listing.group||{};for(const i in t)e[i]=t[i].roles[0];for(const e in i)R[e]=i[e].roles[0];E(e),S(R)}}),[j,T]);const D=o?P().Fragment:dt,V=null==(r=h()>0?{validationState:{status:"error",message:h()>1?`${h()} emails are invalid. Enter valid emails to send invite.`:"1 email is invalid. Enter valid email to send invite."}}:i.MANAGE_TEAM_INVITES&&A()?{validationState:{status:"warning",message:"New members will join your team once they accept your invite."}}:i.SEND_UNAPPROVED_INVITES&&!i.MANAGE_TEAM_INVITES&&A()?{validationState:{status:"warning",message:"Your suggestion will be sent to Team Admin for approval."}}:{})?void 0:r.validationState,W=n&&s&&(null==u?void 0:u.length)>0;return(0,Y.jsxs)(lt,{children:[(0,Y.jsxs)(D,{isDropdownSelected:y,isRolesDropdownVisible:W,isValidationStateVisible:!!V,validationState:null==V?void 0:V.status,"data-testid":"invite-dropdown-container",children:[(0,Y.jsx)(Ke.Z,{onOpen:()=>b(!0),onClose:()=>b(!1),onChange:e=>{d(e),a&&a(e)},options:n?[...f,...w]:[...w,...f],isLoading:N,label:e,value:l,allowCreateNewOption:!0,placeholder:t,className:o,customOptionComponent:e=>(0,Y.jsx)(Qe,{optionData:e,userRoleMap:x,userGroupsRoleMap:R,roleDropdownOptions:u}),onCreateNewOption:e=>{var t;t=e.value,/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)||(e.isInvalid=!0)},closeMenuOnSelect:!0,menuMaxHeight:400,validationState:n?{}:V}),W&&(0,Y.jsx)(U.ZP,{trigger:(0,Y.jsx)(ct,{onClick:()=>g((e=>!e)),children:m?(0,Y.jsx)(pt,{children:(0,Y.jsx)(F,{})}):(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(ht,{children:(0,Y.jsx)(se.ZP,{"data-testid":"invite-dropdown-selected-role",children:null==c?void 0:c.label})}),(0,Y.jsx)(ut,{children:(0,Y.jsx)($e.Z,{})})]})}),onClickOutside:()=>g(!1),onOpen:()=>b(!0),onClose:()=>b(!1),isOpen:_,appendTo:"parent",children:(0,Y.jsx)(_t,{"data-testid":"invite-dropdown-role-options-container",children:u.map((e=>{var t,i;const n=(null==(t=e.state)||null==(t=t.isBlocked)?void 0:t.status)||!1,o=n?ae.Z:P().Fragment;return(0,Y.jsx)(o,{placement:"bottom",content:n?null==(i=e.state)||null==(i=i.isBlocked)?void 0:i.detail:"",children:(0,Y.jsxs)(mt,{onClick:()=>(e=>{var t;(null==(t=e.state)||null==(t=t.isBlocked)?void 0:t.status)||(g(!1),p(e))})(e),isDisabled:n,children:[(0,Y.jsx)(vt,{children:(null==c?void 0:c.value)===e.value&&(0,Y.jsx)(Be.Z,{})}),(0,Y.jsx)(se.ZP,{color:"content-color-primary",children:e.label})]})})}))})})]}),n&&V&&(0,Y.jsx)(rt,{text:V.message,type:V.status})]})};var yt=i(21466);var bt=i(56880);const wt=()=>{const{selectedInvitees:e,selectedRole:t}=(0,L.useContext)(be),i=(0,Ve.getUserId)(),{createTeam:o,isTeamCreationInProgress:l}=(()=>{const e=(0,Ve.getUserId)(),[t,i]=(0,L.useState)(!1);return{createTeam:async()=>{let t;i(!0);try{yt.VSCodeCommunicationsService.postMessageToExtension({type:"BROADCAST_SIDEBAR",payload:{messageType:"SIDEBAR:LOADING",data:{loadingMessage:"Team creation in progress..."}}}),t=await(async(e,t=[],i=!0,o=!0,a)=>await n.postmanGateway.post({url:`${s().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:`/api/users/${e}/start-free-collab`,query:{user_id:e,freecollab:i,auto_join_ws:o,app_version:window.APP_VERSION},service:"god",data:{body:{invitations:t}},signal:a}))(e),i(!1)}catch(e){throw new Error("Error while creating team")}finally{yt.VSCodeCommunicationsService.postMessageToExtension({type:"BROADCAST_SIDEBAR",payload:{messageType:"SIDEBAR:RESET_LOADING"}})}return t},isTeamCreationInProgress:t}})(),{data:c}=(0,Q.useActiveWorkspaceInfo)(),u=(0,Q.useUpdateWorkspace)(),{addToast:h}=(0,K.ZP)();return{sendInvite:async(n,s,l,v,_,g,y,b,w,k)=>{var f,I;let x=null;const R=e.filter((e=>e.userId)),S=e.filter((e=>e.groupId)),T=e.filter((e=>e.__isNew__));let j=!1,O=y;if(y||(O=(await o()).organization_id,j=!0,bt.AnalyticsService.addEventV2({category:n,action:(l===m.workspace?"invite_ws":"share_element")+":create_team",label:"create_new_team",entityId:s,entityType:n})),(null==c?void 0:c.visibilityStatus)===Q.VISIBILITY_STATUS.personal)if(w===E)x=await(0,Q.createWorkspace)(((e,t,i,n)=>{const o={};var s;if(n)for(const e of t){const t=e.isGroup?"group":"user",n=e.isGroup?e.groupId:e.userId;o[t]=Object.assign({},o[t],n&&{[null==n?void 0:n.toString()]:[null==i?void 0:i.defaultRoles.user]})}else o.team={[e]:[null!=(s=null==i?void 0:i.defaultRoles.team)?s:"defaultRole"]};return{name:n?"New Private Workspace":"New Team Workspace",visibilityStatus:n?Q.VISIBILITY_STATUS.private:Q.VISIBILITY_STATUS.team,roles:o}})(O,[...R,...S],_,k)),await(0,Q.moveElementToWorkspace)(n,s,c.id,x.id),bt.AnalyticsService.addEventV2({category:"workspace",action:"share_element:personal_ws_option",label:E,entityId:s,entityType:n}),h({description:`${n} has been moved to ${x.name}.`,type:"success"});else{const e=k?Q.VISIBILITY_STATUS.private:Q.VISIBILITY_STATUS.team;await(0,Q.updateWorkspaceVisibility)(c.id,e),bt.AnalyticsService.addEventV2({category:"workspace",action:"share_element:personal_ws_option",label:"convert_workspace",entityId:s,entityType:n}),h({description:`Workspace visibility changed to ${e}`,type:"success"})}return(R.length>0||S.length>0)&&await(async(e,t,i,n,o,s,a,l,c)=>{if(!i||!a.value)throw new Error("Workspace info/role value not available");const u={invitees:[],action:p.workspace_add_roles,actionData:{}},h=null==n?void 0:n.defaultRoles.user,{action:v,actionData:_}=C({model:e,modelId:t,canUpdateRoles:l,role:a.value,addWorkspaceContext:e!==m.workspace,workspaceDetails:{id:i.id,role:h},sharePublicContext:!1,activeEnvironment:c});for(const e of o)u.invitees.push({id:e.userId,type:d.user});for(const e of s)u.invitees.push({id:e.groupId,type:d.group});u.action=v,u.actionData=_;const g=await r(u);return bt.AnalyticsService.addEventV2({category:e,action:D(e,v),label:"invite_team_users",entityId:t,entityType:e}),g})(n,s,Object.assign({},c,x),_,R,S,t,g,b),T.length>0&&O&&await(async(e,t,i,n,o,s,r,l,d,c,p,u)=>{if(!r||!n||!c.value)throw new Error("Workspace info/teamId/role value not available");const m={users:d.map((e=>({email:e.value}))),target:{},userId:o,teamId:n};m.target=N(e,t,i,n,o,s,r,null==l?void 0:l.defaultRoles.user,c.value,p,u);const h=await a(m);return bt.AnalyticsService.addEventV2({category:e,action:D(e,m.target.meta.action),label:`external_invites_sent:${c.value}`,value:d.length,entityId:t,entityType:e}),h})(n,s,l,O,i,v,Object.assign({},c,x),_,T,t,g,b),(null==(f=x)?void 0:f.id)&&u((null==(I=x)?void 0:I.id)||null),{isNewTeamCreated:j,teamId:O}},isTeamCreationInProgress:l}},kt=()=>e=>{yt.VSCodeCommunicationsService.postMessageToExtension({type:"UPDATE_ACCOUNT_DATA",payload:{teamId:Number(e)}})};var ft=i(97201);const It=W().div.withConfig({displayName:"share-button__StyledButtonContainer",componentId:"sc-1375x0-0"})(["& > button{height:34px;:disabled{background-color:var(--button-primary-background-color) !important;color:var(--button-primary-content-color) !important;opacity:0.5;}}"]),xt=({entityType:e,entityId:t,entityName:i,canUpdateRoles:n,isDisabled:o,updateWorkspaceVisibilityOption:s,isRestrictTeamWorkspaceEnabled:a})=>{const[r,l]=(0,L.useState)(!1),{selectedInvitees:d,selectedEnvironment:c,setSelectedInvitees:p,getInvalidEmailCount:u}=(0,L.useContext)(be),{addToast:m}=(0,K.ZP)(),{data:h,isLoading:v}=(0,Q.useWorkspaceRoleConfig)(),{data:_,isLoading:y}=(0,$.useTeamsByUserId)(),{sendInvite:b}=wt(),w=kt(),k=(()=>{const e=(0,Ve.getUserId)();return()=>{(0,ft.invalidateCache)(["team-details",e])}})();return(0,Y.jsx)(It,{children:(0,Y.jsx)(Z.Z,{type:"primary",text:"Share",isLoading:v||y||r,isDisabled:0===d.length||u()>0||o,onClick:async()=>{bt.AnalyticsService.addEventV2({category:"workspace",action:"share_button_clicked",label:"sharing",entityId:t,entityType:e});try{var o,r;l(!0);const v="No Environment"===(null==c?void 0:c.id)||null==c?void 0:c.id;bt.AnalyticsService.addEventV2({category:`${e}-workbench`,action:`share_${e}`,label:"user_invite",entityType:e,entityId:t,value:1});const{isNewTeamCreated:y,teamId:f}=await b(e,t,i,(null==_||null==(o=_.organizations[0])?void 0:o.domain)||g,h,n,null==_||null==(r=_.organizations[0])?void 0:r.id,v,s,a);y&&f&&(w(f),d=e,u=t,(0,ft.invalidateCache)([H.ACCESS_CONTROL_QUERY_KEY_PREFIX,H.DEFAULT_ROLES,d]),(0,ft.invalidateCache)([H.ACCESS_CONTROL_QUERY_KEY_PREFIX,H.ALL_ROLES,d,u]),(0,ft.invalidateCache)([H.ACCESS_CONTROL_QUERY_KEY_PREFIX,H.ALL_ROLES,d]),k()),m({description:`Successfully shared the ${e}`,status:"success"}),p([]),l(!1)}catch(t){m({description:`Something went wrong while sharing this ${e}`,status:"error"}),l(!1)}var d,u},"data-testid":"share-with-people-button"})})},Et=W().div.withConfig({displayName:"share-invite-dropdown__StyledDropdownContainer",componentId:"sc-g82x7n-0"})(["display:flex;margin-right:",";max-width:480px;"],(({shouldHideShareButton:e})=>e&&"var(--spacing-m)")),Rt=W().div.withConfig({displayName:"share-invite-dropdown__InviteDropdownContainer",componentId:"sc-g82x7n-1"})(["width:",";"],(({shouldHideShareButton:e})=>e?"100%":"calc(100% - 82px)")),St=W().div.withConfig({displayName:"share-invite-dropdown__StyledShareButtonContainer",componentId:"sc-g82x7n-2"})(["margin-top:var(--spacing-xl);margin-right:var(--spacing-xl);"]),Tt=({entityType:e,entityId:t,entityName:i,permissions:n,canManageRolesOnEntity:o,placeholder:s,workspaceVisibility:a,updateWorkspaceVisibilityOption:r,isRestrictTeamWorkspaceEnabled:l,showRoleDropdown:d})=>{const c=!a||a===Q.VISIBILITY_STATUS.personal;return(0,Y.jsxs)(Et,{shouldHideShareButton:c,children:[(0,Y.jsx)(Rt,{shouldHideShareButton:c,children:(0,Y.jsx)(gt,{placeholder:s,permissions:n,canManageRolesOnEntity:o,showRoleDropdown:d})}),!c&&(0,Y.jsx)(St,{children:(0,Y.jsx)(xt,{entityType:e,entityId:t,entityName:i,canUpdateRoles:o,updateWorkspaceVisibilityOption:r,isRestrictTeamWorkspaceEnabled:l})})]})};var jt=i(31987),Ct=i(38163),Ot=i(94250);const Nt=W().div.withConfig({displayName:"update-workspace-visibility-options__StyledContainer",componentId:"sc-7a97m6-0"})(["margin-left:var(--spacing-xl);"]),At=W().div.withConfig({displayName:"update-workspace-visibility-options__StyledRadioGroupContainer",componentId:"sc-7a97m6-1"})(["margin-bottom:20px;"]),Dt=W().div.withConfig({displayName:"update-workspace-visibility-options__StyledShareButtonContainer",componentId:"sc-7a97m6-2"})(["margin-bottom:var(--spacing-xl);"]),Lt=W().div.withConfig({displayName:"update-workspace-visibility-options__StyledBannerContainer",componentId:"sc-7a97m6-3"})(["margin-bottom:20px;margin-right:var(--spacing-xl);"]),Pt=({entityType:e,entityId:t,entityName:i,workspaceVisibility:n,selectedOption:o,setSelectedOption:s,canManageRolesOnEntity:a,isRestrictTeamWorkspaceEnabled:r})=>{var l;const{setRoleOptions:d,roleOptions:c,setIsRoleOptionsLoading:p,selectedRole:u,setSelectedRole:m}=(0,L.useContext)(be),{data:h,isLoading:v}=(0,H.useFetchDefaultRolesForObjectType)(e,!0,!0),{data:_,isLoading:g}=(0,H.useFetchRolesForObject)(e,t,!0,!0),{data:y,isLoading:E}=(0,H.useFetchRolesForObjectType)(e,!0,!0),R=(0,H.useFetchAssociatedRoles)(),{data:T,isLoading:j}=(0,$.useTeamsByUserId)(),C=null==T||null==(l=T.organizations[0])?void 0:l.id;return(0,L.useEffect)((()=>{if(!(c.length>0)&&y&&_&&h){const{rolesList:t,rolesOrder:i,defaultRoles:n}=R(e,_,y,null==h?void 0:h.data),o=S(i.reduce(((e,i)=>{const n=t[i];return n&&e.push(n),e}),[]),["state.isBlocked.status"],["asc"]);d(o.map((e=>({label:e.displayName,value:e.name,state:e.state}))));const s=o.find((e=>e.name===n.user));u.label||m({label:(null==s?void 0:s.displayName)||o[0].displayName,value:(null==s?void 0:s.name)||o[0].name}),p(!1)}}),[E,g,v]),n!==Q.VISIBILITY_STATUS.personal?null:E||g||v||j?(0,Y.jsx)(F,{}):(0,Y.jsxs)(Nt,{children:[(0,Y.jsx)(At,{"data-testid":"update-workspace-visibility-options-container",children:(0,Y.jsxs)(jt.Z,{direction:"column",value:o,onChange:s,label:"Choose how you want to share:","data-testid":"update-workspace-visibility-options-radio-group",children:[(0,Y.jsx)(Ct.Z,{"data-testid":"move-to-new-workspace-radio",value:k(),label:b(e,r),helperText:w(e,r)}),(0,Y.jsx)(Ct.Z,{"data-testid":"convert-workspace-radio",value:x(),label:f(e,r),helperText:I(e,r)})]})}),!C&&(0,Y.jsx)(Lt,{"data-testid":"create-team-info-banner",children:(0,Y.jsx)(Ot.Z,{status:"info",children:"Since you don't have a team yet, we'll create one for your members."})}),(0,Y.jsx)(Dt,{children:(0,Y.jsx)(xt,{entityType:e,entityId:t,entityName:i,canUpdateRoles:a,updateWorkspaceVisibilityOption:o,isDisabled:null===o,isRestrictTeamWorkspaceEnabled:r})})]})};var Vt=i(88749);const Wt=new class{constructor(){var e=this;this.observer=null,this.workspaceId="",this.abortController=null,this.asyncObserver=null,this.changeWorkspace=e=>{this.workspaceId&&this.unsubscribe(),this.workspaceId=e},this.subscribe=async function({workspaceId:t=e.workspaceId,subscriptionHandler:i}){if(""===t)return;if(e.workspaceId!==t&&e.changeWorkspace(t),e.observer||e.asyncObserver)return;const{asyncObserver:n,abortController:o}=(0,Q.subscribeToWorkspaceEvents)(t);e.abortController=o,e.asyncObserver=n,e.observer=await n,e.abortController=null,e.observer.subscribe({next:e=>{i(e,{workspaceId:t})},complete:()=>{e.unsubscribe()},error:async function(n){e.cleanup(),await e.subscribe({subscriptionHandler:i,workspaceId:t})}})},this.unsubscribe=()=>{var e,t;null==(e=this.abortController)||e.abort(),null==(t=this.observer)||t.unsubscribe(),this.cleanup()},this.cleanup=()=>{this.asyncObserver=null,this.observer=null,this.abortController=null}}},Ut=W().div.withConfig({displayName:"share-popover-content__StyledContainer",componentId:"sc-2tguj8-0"})(["display:flex;flex-direction:column;width:480px;background-color:var(--background-color-primary);border-radius:var(--border-radius-default);"]),Zt=({entityType:e,entityId:t,entityName:i})=>{var n,o;const{workspaceVisibility:s,isWorkspaceInfoLoading:a}=(0,L.useContext)(be),[r,l]=(0,L.useState)(null),{permissionCheckResults:d,triggerPermissionChecks:c}=Me(),{planFeatures:p,isLoading:u}=(()=>{var e;const t=(0,Ve.getUserId)(),{data:i,isLoading:n,isError:o,isRefetching:s,refetch:a}=(0,Vt.useGetPlanFeatures)(t);return{planFeatures:null==i||null==(e=i.data)?void 0:e.features,isLoading:n,isError:o,isRefetching:s,refetch:a}})(),{data:m,isLoading:h,isRefetching:v}=(0,$.useTeamsByUserId)(),_=(0,Ve.getUserId)(),g=null==m||null==(n=m.organizations[0])?void 0:n.id;(()=>{const e=(0,Q.useActiveWorkspaceId)(),t=(()=>{const{setWorkspaceVisibility:e}=(0,L.useContext)(be),t=(()=>{const e=(0,Q.useActiveWorkspaceId)();return()=>{(0,ft.invalidateCache)([Q.WORKSPACE_ROLES_QUERY_KEY,e])}})();return i=>{var n;const o=i.data;if("update_visibility"===(null==(n=i.meta)?void 0:n.action))for(const i of o)if(i.path.includes("/visibilityStatus")){const n=i.value;e(n),t()}}})();(0,L.useEffect)((()=>{if(e)return Wt.subscribe({workspaceId:e,subscriptionHandler:t}),()=>{Wt.unsubscribe()}}),[e])})();const y=d[A(e,"update")],b=null==p||null==(o=p.restrict_team_workspace_creation)?void 0:o.value;return(0,L.useEffect)((()=>{h||v||c(g||"0",{checks:{[A(e,"update")]:{entityType:"user",entityId:_,permission:A(e,"update"),objectType:e,objectId:t},MANAGE_TEAM_INVITES:{entityType:"user",entityId:_,permission:"MANAGE_TEAM_INVITES",objectType:"team",objectId:g||"0"},SEND_UNAPPROVED_INVITES:{entityType:"user",entityId:_,permission:"SEND_UNAPPROVED_INVITES",objectType:"team",objectId:g||"0"}}})}),[g,h,v]),(0,Y.jsx)(K.VW,{children:(0,Y.jsx)(Ut,{"data-testid":"share-popover-contents-container",children:s===Q.VISIBILITY_STATUS.personal?(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(Tt,{placeholder:"Add name, group name or email...",entityType:e,entityId:t,entityName:i,permissions:d,canManageRolesOnEntity:y,workspaceVisibility:s,updateWorkspaceVisibilityOption:r,isRestrictTeamWorkspaceEnabled:b,showRoleDropdown:!!g}),(0,Y.jsx)(Ce,{entityType:e}),(0,Y.jsx)(Ae,{height:"24px"}),(0,Y.jsx)(Pt,{entityType:e,entityId:t,entityName:i,canManageRolesOnEntity:y,updateWorkspaceVisibilityOption:r,workspaceVisibility:s,selectedOption:r,setSelectedOption:l,isRestrictTeamWorkspaceEnabled:b})]}):(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(Tt,{placeholder:"Add name, group name or email...",entityType:e,entityId:t,entityName:i,permissions:d,canManageRolesOnEntity:y,workspaceVisibility:s,updateWorkspaceVisibilityOption:r,isRestrictTeamWorkspaceEnabled:b}),(0,Y.jsx)(xe,{entityType:e,entityId:t,canManageRolesOnEntity:y,workspaceVisibility:s,isWorkspaceInfoLoading:a}),(0,Y.jsx)(Ae,{height:"24px"}),(0,Y.jsx)(Ce,{entityType:e}),(0,Y.jsx)(Ze,{entityType:e,entityId:t})]})})})},Mt=W()(U.ZP).withConfig({displayName:"share-button__StyledPopover",componentId:"sc-djv8ww-0"})([".tippy-content{padding:var(--spacing-zero);}.aether-dropdown__dropdown-indicator{padding:var(--spacing-zero) !important;}"]),Kt=({entityType:e,entityId:t,entityName:i})=>(0,Y.jsx)(we,{children:(0,Y.jsx)(Mt,{trigger:(0,Y.jsx)(Z.Z,{"data-testid":"collaboration-share-button",type:"tertiary",text:"Share",icon:(0,Y.jsx)(M.Z,{})}),onOpen:()=>{bt.AnalyticsService.addEventV2({category:"workspace",action:"share_element:initiate",label:"sharing",entityId:t,entityType:e})},onClose:()=>{bt.AnalyticsService.addEventV2({category:"workspace",action:"share_popover_closed",label:"sharing",entityId:t,entityType:e})},appendTo:"parent",maxWidth:"550px",children:(0,Y.jsx)(Zt,{entityType:e,entityId:t,entityName:i})})});var $t=i(49437),Bt=i(22135);const Gt=({loadingMessage:e=""})=>(0,Y.jsx)(G.Z,{size:"large",description:e}),Yt=({entityType:e,entityId:t,entityName:i,teamId:n,userId:o,workspaceInfo:s,permissions:a,selectedRole:r,userTeamDomain:d,workspaceDefaultRole:c})=>{const{selectedEnvironment:p}=(0,L.useContext)(be),[u,m]=(0,L.useState)(!1),[h,v]=(0,L.useState)(!1),{addToast:_}=(0,K.ZP)(),g=u?(0,Y.jsx)(De.Z,{}):(0,Y.jsx)(Le.Z,{});return n&&s?(0,Y.jsx)(Z.Z,{onClick:async()=>{if(a.MANAGE_TEAM_INVITES||a.SEND_UNAPPROVED_INVITES){if(!u){v(!0);try{const u=N(e,t,i,n,o,d,s,c,r.value,a.UPDATE_WORKSPACE_ROLES,p.id),h=(await l(u)).multiuse_invitations[0].link;navigator.clipboard.writeText(h),m(!0),setTimeout((()=>{m(!1)}),2e3)}catch(e){_({status:"error",description:"Something went wrong while generating the invite link."})}finally{v(!1)}}}else _({status:"error",description:"You do not have admin permission to perform this action"})},type:"tertiary","data-testid":"copy-link-btn",icon:g,text:u?"Copied":"Copy Invite Link",isLoading:h}):null},zt=W()(Z.Z).withConfig({displayName:"invite-to-ws__StyledButton",componentId:"sc-gx1fsb-0"})([":disabled{background-color:var(--button-primary-background-color) !important;color:var(--button-primary-content-color) !important;opacity:0.5;}"]),Ft=e=>{var t;const i=(0,Q.useActiveWorkspaceId)(),[n,o]=(0,L.useState)(),{data:s,isLoading:a,isError:r,refetch:l}=(0,Q.useActiveWorkspaceInfo)(),d=(0,Ve.getUserId)(),{selectedInvitees:c,selectedRole:p,setSelectedRole:u,roleOptions:h,setRoleOptions:v,setIsRoleOptionsLoading:_,getInvalidEmailCount:y}=(0,L.useContext)(be),{data:b,isLoading:w,isRefetching:k,refetch:f}=(0,$.useTeamsByUserId)(),{data:I,isLoading:x,refetch:E}=(0,Q.useWorkspaceRoleConfig)(),{permissionCheckResults:R,triggerPermissionChecks:S,isError:T}=Me(),{sendInvite:j,isTeamCreationInProgress:C}=wt(),[O,N]=(0,L.useState)(!0),[A,D]=(0,L.useState)(!1),P=kt(),V=()=>{D(!1),N(!0),l(),E(),f()};return(0,L.useEffect)((()=>{bt.AnalyticsService.addEventV2({category:"workspace",action:"invite_ws:initiate",label:"invite_to_ws_open",entityId:i,entityType:"workspace"}),V(),(0,ft.invalidateCache)([Q.WORKSPACE_ROLES_QUERY_KEY,i])}),[]),(0,L.useEffect)((()=>{_(x)}),[x,_]),(0,L.useEffect)((()=>{var e;!w&&null!=b&&null!=(e=b.organizations[0])&&e.id&&o(b.organizations[0].id)}),[w,b]),(0,L.useEffect)((()=>{w||k||(d&&n?S(i+n,{checks:{MANAGE_TEAM_INVITES:{entityType:"user",entityId:d,permission:"MANAGE_TEAM_INVITES",objectType:"team",objectId:n},SEND_UNAPPROVED_INVITES:{entityType:"user",entityId:d,permission:"SEND_UNAPPROVED_INVITES",objectType:"team",objectId:n},UPDATE_WORKSPACE_ROLES:{entityType:"user",entityId:d,permission:"UPDATE_WORKSPACE_ROLES",objectType:"workspace",objectId:i}}}):S(i+d,{checks:{UPDATE_WORKSPACE_ROLES:{entityType:"user",entityId:d,permission:"UPDATE_WORKSPACE_ROLES",objectType:"workspace",objectId:i}}}))}),[n,d,i,w,k]),(0,L.useEffect)((()=>{if(!x&&I){const t=I.teamRoles.default[0]||[],i=[];for(const n of t){var e;null!=(e=n.state)&&null!=(e=e.isInvalid)&&e.status||i.push({label:n.displayName,value:n.name,desc:n.description,state:n.state})}v(i);const n=i.find((e=>e.value===I.defaultRoles.user));n&&u(n)}}),[x,I]),(0,L.useEffect)((()=>{Object.keys(R).length>0&&!a&&!w&&N(!1)}),[R,a,w]),(0,L.useEffect)((()=>{(T||r)&&D(!0)}),[T,r]),A?(0,Y.jsx)(oe.Z,{padding:"spacing-l",children:(0,Y.jsx)($t.Z,{title:"Couldn’t load Invite form",description:"Just a faulty wire. Try reloading.",primaryAction:(0,Y.jsx)(Z.Z,{type:"outline",text:"Reload",onClick:V}),children:(0,Y.jsx)(Bt.Z,{})})}):O?(0,Y.jsx)(Gt,{loadingMessage:C?"Team creation in progress...":""}):(0,Y.jsx)(oe.Z,{className:"workspace-role-selection",direction:"row",justifyContent:"space-between",alignItems:"center",width:"100%",children:(0,Y.jsxs)(oe.Z,{direction:"column",width:"100%",gap:"spacing-m",children:[(null==s?void 0:s.visibilityStatus)===Q.VISIBILITY_STATUS.personal&&(0,Y.jsx)(Ot.Z,{status:"info",children:"Inviting people will change this into a team workspace."}),(0,Y.jsx)(gt,{label:"Name, email, or group name",permissions:R,showRoleDropdown:!1,className:"invite-to-ws-input-dropdown",canManageRolesOnEntity:R.UPDATE_WORKSPACE_ROLES,onChange:e.onChange}),R.UPDATE_WORKSPACE_ROLES&&n&&(0,Y.jsx)(te.Z,{className:"invite-to-ws-role-dropdown",onChange:e=>{u(e)},options:h,value:p,isLoading:x,isOptionDisabled:qe,label:"Role",customOptionComponent:Xe,isSearchable:!1,isClearable:!1}),(0,Y.jsxs)(oe.Z,{justifyContent:"space-between",children:[n&&(0,Y.jsx)(Yt,{entityType:m.workspace,entityId:i,entityName:null==s?void 0:s.name,teamId:n,userId:d,workspaceInfo:s,workspaceDefaultRole:null==I?void 0:I.defaultRoles.user,permissions:R,selectedRole:p,userTeamDomain:(null==b||null==(t=b.organizations[0])?void 0:t.domain)||g}),(0,Y.jsx)(zt,{type:"primary",text:"Send Invite","data-testid":"invite-btn",onClick:async()=>{N(!0);try{var t;const{isNewTeamCreated:o,teamId:a}=await j(m.workspace,i,null==s?void 0:s.name,(null==b||null==(t=b.organizations[0])?void 0:t.domain)||g,I,R.UPDATE_WORKSPACE_ROLES,n);null==e.onSuccess||e.onSuccess(),o&&a&&P(a)}catch(t){null==e.onError||e.onError()}finally{N(!1)}},isLoading:w||x,isDisabled:0===c.length||y()>0})]})]})})},Ht=({onInviteSuccess:e,onInviteError:t,onChange:i})=>(0,Y.jsx)(we,{children:(0,Y.jsx)(Ft,{onSuccess:e,onError:t,onChange:i})})}}]);
//# sourceMappingURL=7378.a8ee59f4ae5329d1.js.map