"use strict";(self.webpackChunkcollection_workbench=self.webpackChunkcollection_workbench||[]).push([[4776],{44776:(e,s,r)=>{r.r(s),r.d(s,{ENTITY_TYPE:()=>L,GROUP_ROLES:()=>Y,OP:()=>f,ROLE_TYPE:()=>V,VISIBILITY_STATUS:()=>g,WORKSPACE_ELEMENTS_TYPE:()=>K,WORKSPACE_ROLES_QUERY_KEY:()=>v,createWorkspace:()=>m,moveElementToWorkspace:()=>G,subscribeToWorkspaceEvents:()=>I,updateWorkspaceVisibility:()=>C,useActiveWorkspaceId:()=>a,useActiveWorkspaceInfo:()=>E,useNavigateToWorkspace:()=>y,useUpdateWorkspace:()=>W,useWorkspace:()=>d,useWorkspaceRoleConfig:()=>A,useWorkspaceRoles:()=>T,useWorkspaceSubscription:()=>S,workspaceInfoQuery:()=>l,workspaceRolesQuery:()=>R});var t=r(60607);const a=()=>{const{workspaceId:e}=(0,t.useParams)();return e?(e=>(null==e?void 0:e.split("~").pop())||"")(e):""};var o=r(98283),n=r(97201),i=r(45860),c=r(26663),u=r.n(c);const l=(e,s)=>({queryKey:["workspace",e],queryFn:()=>(async(e,s)=>await i.postmanGateway.post({url:`${u().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:`/workspaces/${e}`,method:"GET",signal:s,service:"workspaces"}))(e),enabled:!!e,useErrorBoundary:null==s?void 0:s.useErrorBoundary,initialData:p(e)});function p(e){var s;if(e&&null!=(s=window)&&s.INITIAL_WORKSPACE)try{var r;const s=JSON.parse(null==(r=window)?void 0:r.INITIAL_WORKSPACE);if((null==s?void 0:s.id)===e)return{data:s}}catch(e){console.info("::workspace-service::getCachedWorkspaceData::",e)}}const b=["data"],d=e=>{const s=(0,n.useDataFetch)(l(e)),{data:r}=s,t=(0,o.Z)(s,b);return Object.assign({data:null==r?void 0:r.data},t)},E=()=>{const e=a();return d(e)};var w=r(40540),h=r(39245),k=r(21466);const y=()=>{const e=(0,h.useNavigate)();return(0,w.useCallback)((s=>{(0,k.onWorkspaceChange)(s),s&&e("/workspace/"+s)}),[e])},v="workspace-roles",R=(e,s,r)=>({queryKey:[v,e],queryFn:()=>(async(e,s="guest",r)=>await i.postmanGateway.get({url:`${u().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:`/workspaces/${e}/roles?include=${s}`,signal:r,service:"workspaces"}))(e,s,r),enabled:!!e,useErrorBoundary:!1}),_=["data"],T=(e,s)=>{const r=(0,n.useDataFetch)(R(e,s)),{data:t}=r,a=(0,o.Z)(r,_);return Object.assign({data:null==t?void 0:t.data},a)},O=["data"],A=e=>{const s=(0,n.useDataFetch)(((e,s)=>({queryKey:["workspace-role-config"],queryFn:()=>(async(e="",s)=>await i.postmanGateway.get({url:`${u().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:`/workspaces-role-config?include=partner,default,state,guest${e}`,signal:s,service:"workspaces"}))(e,undefined),useErrorBoundary:!1}))(e)),{data:r}=s,t=(0,o.Z)(s,O);return Object.assign({data:null==r?void 0:r.data},t)},W=()=>{const e=(0,h.useNavigate)();return(0,w.useCallback)((e=>{(0,k.updateVSCodeWorkspace)(e)}),[e])},I=e=>{const s=new AbortController;return{asyncObserver:i.postmanWebsocketGateway.subscribe({signal:s.signal,subscribeRequest:{method:"GET",url:"/ws/proxy",body:{},path:`/workspaces/${e}/subscribe`,service:"workspaces"},subscriptionEvents:["update","update_roles","workspace_v1","create","destroy"],responseFilter:e=>{var s;return null==e||null==(s=e.body)||null==(s=s.data)?void 0:s.id},broadcastFilter:e=>{var s;return null==e||null==(s=e.meta)||null==(s=s.timeline)?void 0:s.model_id},unsubscribeRequest:{method:"delete",url:"/ws/proxy",body:{},path:`/workspaces/${e}/subscribe`,service:"workspaces"}}),abortController:s}},P=new class{constructor(){var e=this;this.observer=null,this.workspaceId="",this.abortController=null,this.asyncObserver=null,this.subscriptionsMap={},this.changeWorkspace=e=>{this.workspaceId&&this.unsubscribe(),this.workspaceId=e},this.publishEventToSubscriptions=(e,s)=>{for(const r of Object.values(this.subscriptionsMap))try{r(e,s)}catch(e){}},this.init=async function(s){const{asyncObserver:r,abortController:t}=I(s);e.abortController=t,e.asyncObserver=r,e.observer=await r,e.abortController=null,e.observer.subscribe({next:r=>{e.publishEventToSubscriptions(r,{workspaceId:s})},complete:()=>{e.unsubscribe()},error:async function(r){e.cleanup(),await e.init(s)}})},this.subscribe=({workspaceId:e=this.workspaceId,subscribingEntityId:s,subscriptionHandler:r})=>{if(""!==e&&(this.workspaceId!==e&&this.changeWorkspace(e),s))return this.subscriptionsMap[s]=r,this.observer&&this.asyncObserver||this.init(e),()=>{delete this.subscriptionsMap[s],0===Object.keys(this.subscriptionsMap).length&&this.unsubscribe()}},this.unsubscribe=()=>{var e,s;null==(e=this.abortController)||e.abort(),null==(s=this.observer)||s.unsubscribe(),this.cleanup()},this.cleanup=()=>{this.asyncObserver=null,this.observer=null,this.abortController=null,this.subscriptionsMap={}}}},S=(e,s)=>{const r=a();(0,w.useEffect)((()=>{if(r&&e){const t=P.subscribe({workspaceId:r,subscribingEntityId:e,subscriptionHandler:s});return()=>{t&&t()}}}),[r])},C=async(e,s,r)=>await i.postmanGateway.put({url:`${u().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:`/workspaces/${e}/visibility`,method:"PUT",data:{body:{visibilityStatus:s}},signal:r,service:"workspaces"}),m=async(e,s)=>(await i.postmanGateway.post({url:`${u().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,data:{body:e},service:"workspaces",path:"/workspaces",signal:s})).data;let g=function(e){return e.personal="personal",e.team="team",e.private="private",e.public="public",e.partner="partner",e}({}),f=function(e){return e.replace="replace",e.add="add",e.remove="remove",e}({}),K=function(e){return e.collection="collection",e.environment="environment",e.API="api",e.mock="mock",e.monitor="monitor",e.flow="flow",e.extensibleCollection="extensibleCollection",e}({});const G=async(e,s,r,t,a)=>(await i.postmanGateway.patch({url:`${u().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,data:{body:{op:f.replace,value:{to:t,elementType:e}}},service:"workspaces",path:`/workspaces/${r}/elements/${s}`,signal:a})).data;let L=function(e){return e.user="user",e.team="team",e.group="group",e}({}),V=function(e){return e.WORKSPACE_EDITOR="WORKSPACE_EDITOR",e.WORKSPACE_VIEWER="WORKSPACE_VIEWER",e.WORKSPACE_EDITOR_V9="WORKSPACE_EDITOR_V9",e.WORKSPACE_VIEWER_V9="WORKSPACE_VIEWER_V9",e.WORKSPACE_ANONYMOUS_EXPLORER="WORKSPACE_ANONYMOUS_EXPLORER",e.WORKSPACE_EXPLORER="WORKSPACE_EXPLORER",e}({}),Y=function(e){return e.SIGNEDIN="signed-in",e.ANYBODY="anybody",e}({})}}]);
//# sourceMappingURL=4776.da9a859eddae3000.js.map